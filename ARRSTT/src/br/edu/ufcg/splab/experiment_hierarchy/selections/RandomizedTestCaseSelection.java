package br.edu.ufcg.splab.experiment_hierarchy.selections;

import java.util.Random;

import br.edu.ufcg.splab.experiment_hierarchy.util.testcollections.TestCase;
import br.edu.ufcg.splab.experiment_hierarchy.util.testcollections.TestSuite;

/**
 * Objective: Generate a sub set that is generated by members of a bigger set
 * selected through a random pattern.
 * 
 * Description of use: In the Experiment Factory this class is used in the
 * process of building a selection.
 *
 */
public class RandomizedTestCaseSelection implements InterfaceTestCaseSelector {
	private Random randomizer;

	public RandomizedTestCaseSelection() {
		this.randomizer = new Random();
	}

	@Override
	public TestSuite select(TestSuite testSuite, Double percentage) {
		int howMany = getAmountOfTestCases(testSuite, percentage);
		TestSuite helper = new TestSuite();
		helper.addAll(testSuite);
		TestSuite chosen = new TestSuite();

		while (chosen.size() < howMany) {
			int choice = randomizer.nextInt(helper.size());
			if (!chosen.contains(helper.get(choice))) {
				TestCase theOne = helper.get(choice);
				chosen.add(theOne);
				helper.remove(theOne);

			}
		}
		return chosen;
	}

	/**
	 * Objective: Calculate the dimension of the smaller test suite.
	 * 
	 * Description of use: This method is used on the select method to help
	 * build the new test suite.
	 *
	 * @param ts
	 *            the original test suite
	 * @param percentage
	 *            the desired percentage of test case.
	 * @return how many shall be selected.
	 */
	private int getAmountOfTestCases(TestSuite ts, Double percentage) {
		return (int) Math.ceil(ts.size() * percentage);
	}
}